<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8" />
     <title>게시글 상세 화면</title>
     <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
     <meta name="description" content="" />
     <meta name="author" content="" />
     <title>그린 프로젝트</title>
     <!-- Favicon-->
     <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />
     <!-- Bootstrap icons-->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" type="text/css" />
     <!-- Google fonts-->
     <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css" />
     <!-- Core theme CSS (includes Bootstrap)-->
     <link href="/css/styles.css" rel="stylesheet" />
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	</head>
	<body>
	 <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
            <div class="container px-4 px-lg-5">
                <table width = "800">
                  <tr>
                      <td width = "150">
                          <a class="navbar-brand"  href="/index">메인메뉴</a>
                      </td>
                      <td width = "150">
                        <a class="navbar-brand" href="#introduction">소개</a>
                    </td>  
                    <td width = "150">
                        <a class="navbar-brand" href="/rank">친환경 제품 소개</a>
                    </td>  
                    <td width = "150">
                        <div class="dropdown">
	                    	<div class="navbar-band">
	                            <a class="dropbtn" onclick="location.href='/b_freetalk'">커뮤니티</a>
	                        </div>
                            <div class="dropdown-content">  
                                <a id="testtt2" onclick="location.href='/b_prove'">인증게시판</a>
                                <a onclick="location.href='/b_mission'">미션게시판</a>
	                        </div>
	                    </div>
                    </td>  
                  </tr>
                </table>

                <button class="navbar-toggler navbar-toggler-right" id="buttoncar" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
               
               
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto" th:if="${sess_id == null}">
                        <li class="nav-item"><a class="nav-link" href="/login">로그인</a></li>
                        <li class="nav-item"><a class="nav-link" href="/join">회원가입</a></li>

                    </ul>
                    <ul class="navbar-nav ms-auto" th:if="${sess_id != null}">
                        <li class="nav-item"><span class="nav-link"> [[${sess_id}]]님</span></li>
                        <li class="nav-item"><a class="nav-link" href="/logout">로그아웃</a></li>
                    </ul>
                </div>
            </div>
        </nav>
	<div>
		<span  th:text="${board.postNum + '번호'}"></span> 
        <span  th:text="${board.title + '제목'}"></span>
        <span  th:text="${board.content + '내용'}"></span>
        <span  th:text="${board.uploadDate + '게시일'}"></span>
        <input type="image" id="recommend-btn" alt="recommend-img" src="/img/like/like.png" width="30px">
        <span  th:text="${board.imageUrl + '이미지'}"></span>
        <span  th:text="${board.category + '카테고리'}"></span>
        <span  th:text="${board.userId + '사용자'}"></span>
        <div th:if="${#strings.equals(board.userId, sess_id)}">
        	<button id="edit">수정하기</button>
        	<button id="remove">삭제하기</button>
        </div>
    </div>


	<tr>
		<td><a id="recommend">좋아요</a>
		</td>

	</tr>
    <script th:inline="javascript">
    	var check_did_recommend = function(update){
    		axios
			.get('/board/list/like?boardnum=' + [[${board.postNum}]] + '&update=' + update)
			.then(function (response) {
				// 통신결과 : 누른 적이 있다.
				// 좋아요 수 - 1
				var res = response.data
				var goodBtn = document.querySelector("#recommend-btn");
				console.log(res.state);
				if(res.state === "doLike"){
					console.log("좋아요 함");
					// 좋아요 이미지로 변경
					goodBtn.setAttribute("src", "/img/like/like.png");
				}else if(res.state === "doUnlike"){
					console.log("좋아요 취소 함");
					// 좋아요 안함 이미지로 변경
					goodBtn.setAttribute("src", "/img/like/unlike.png");
				}else if(res.state === "justCheck"){
					console.log("값만 가져옴");
					// 좋아요 했는지 판단해서 값 변경
					if (res.didLike==0){
						goodBtn.setAttribute("src", "/img/like/unlike.png");
					}else{
						goodBtn.setAttribute("src", "/img/like/like.png");
					}
				}
			})
			.catch(function () {
				alert("실패");
			}); 
    	}
    	window.onload = function(){
    		check_did_recommend(false);
    	}
    	document.querySelector("#recommend-btn").onclick = function(){
    	// 통신 : 현재 boardNum, 현재 로그인한 아이디(세션 아이디) -> 좋아요를 눌렀는지를 판단한다.
    	// 통신 url 요청 지정
    		check_did_recommend(true);
    	}	
    </script>

</body>
</html>